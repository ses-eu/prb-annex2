project:
  type: book
  output-dir: _book

execute:
  freeze: false
  echo: false
  warning: false
  fig-process: pdfcrop

format:
  pdf: 
    documentclass: scrreprt
    pdf-engine: xelatex
    fig-crop: true
    fig-pos: 'H'
    keep-tex: true
    toc: true
    toc-depth: 3 
    lof: false
    fontsize: 12pt
    # fig-format: "pdf"
    geometry:
      - a4paper
      # - showframe
      # - inner=3cm
      # - outer=4cm
      - top=2cm
      - bottom=1.5cm
      - left=2.5cm
      - right=2.2cm
      - footskip=1.3cm
      - includefoot           # <-- important

    template-partials:
      - toc.tex
    
    include-in-header:
      - text: |
      
          \usepackage{xurl}      % better URL/word breaking
          \usepackage[table]{xcolor}  % <-- provides \arrayrulecolor via colortbl

          % --- Heading fonts/colors (KOMA-Script; no titlesec) ---
          \definecolor{CHAPBLUE}{HTML}{0050A0}
          \definecolor{SECBLUE}{HTML}{2C5EBD}
          \definecolor{SUBSECBLUE}{HTML}{7D9FE0}
          \definecolor{HeaderShade}{HTML}{DDE6F7}
          \definecolor{DataShade}{HTML}{FFFFFF}
          
          % ---- for latex tables
          \usepackage{caption}
          \usepackage{multirow}
          \usepackage{hhline}
          \usepackage{siunitx}
          
          % helper: shaded caption text
          % Full-width shaded caption line (fills \linewidth)
          \newcommand{\captionbar}[1]{%
            \noindent
            \setlength{\fboxrule}{\arrayrulewidth}% match table border thickness
            \setlength{\fboxsep}{3pt}% inner padding (tune)
            \fcolorbox{CHAPBLUE}{CHAPBLUE}{%
              \parbox{\dimexpr\linewidth-2\fboxsep-2\fboxrule\relax}{%
                \textcolor{white}{\strut\ #1\ }%
              }%
            }%
          }
          
          \newcommand{\thickhline}{\noalign{\hrule height 0.85pt}}

          % Load tocloft package for TOC customization
          \usepackage{tocloft}

          % custom toc moved to toc.tex
          
          % --------------------- FONTS ---------------------

          % Point fontspec at your per-user fonts folder
          \newfontfamily\aptos{Aptos}[
            Path = fonts/,
            Extension = .ttf,
            UprightFont = Aptos,
            BoldFont = Aptos-Bold,
            ItalicFont = Aptos-Italic,
            BoldItalicFont = Aptos-Bold-Italic
          ]
          
          \newfontfamily\aptosDisplay{Aptos Display}[
            Path = fonts/,
            Extension = .ttf,
            UprightFont = Aptos-Display,
            BoldFont = Aptos-Display-Bold,
            ItalicFont = Aptos-Display-Italic,
            BoldItalicFont = Aptos-Display-Bold-Italic
          ]   

          % --------------------- COVER PAGE ---------------------
          
          \usepackage{graphicx}  % Allows inserting images
          \usepackage{eso-pic}   % Enables full-page backgrounds
          \usepackage{everypage} % Alternative package for first-page modifications
          % \usepackage{hyperref}  % Enables hyperlinks
          % \hypersetup{colorlinks=true, urlcolor=blue} % Set hyperlinks to be blue and underlined
          
          % Cover-only flag (do not tie cover decorations to page numbers)
          \newif\ifCCcoverpage
          \CCcoverpagefalse
          
          % Cover images
          \newcommand\CoverImage{images/background_cover_page.png}
          
          % Cover background image (cover only)
          \AddToShipoutPictureBG*{%
            \ifCCcoverpage
              \AtPageLowerLeft{%
                \hspace*{0cm}%
                \raisebox{\dimexpr\paperheight-8.87cm-16.34cm\relax}{%
                  \includegraphics[width=17.79cm,height=16.34cm]{\CoverImage}%
                }%
              }%
            \fi
          }
          
          \newcommand\CoverLogo{images/logo_cover.png}
          
          % Cover logo (cover only): x=2.29cm from left, y=2.74cm from top, size 5.82cm x 1.44cm
          \AddToShipoutPictureBG*{%
            \ifCCcoverpage
              \AtPageLowerLeft{%
                \hspace*{2.29cm}%
                \raisebox{\dimexpr\paperheight-2.74cm-1.44cm\relax}{%
                  \includegraphics[width=5.82cm,height=1.44cm]{\CoverLogo}%
                }%
              }%
            \fi
          }
          
          % --- Cover footer text (cover only) ---
          \AddToShipoutPictureFG{%
            \ifCCcoverpage
              \AtPageLowerLeft{%
                \hspace*{2.29cm}%
                \raisebox{2.5cm}{%
                  {\aptos\upshape\mdseries\fontsize{7pt}{9pt}\selectfont\color{black}%
                    \parbox[t]{0.9\paperwidth}{%
                      Performance Review Board of the Single European Sky \textbar\ Rue de Mot 28, 1040 Etterbeek\par
                      MOVE-PRB-SECRETARIAT@ec.europa.eu \textbar\ eu-single-sky.transport.ec.europa.eu%
                    }%
                  }%
                }%
              }%
            \fi
          }%
          
          % --- TITLE
          \makeatletter
          \providecommand{\@subtitle}{} % safety: if subtitle isn't defined, treat as empty
          
          \renewcommand{\maketitle}{%
            \global\CCcoverpagetrue
            \begin{titlepage}
              \thispagestyle{empty}%
              \AddToShipoutPictureFG*{%
                \AtPageLowerLeft{%
                  \hspace*{2.5cm}% left alignment (match your left margin)
                  \raisebox{\dimexpr\paperheight-6.5cm\relax}{%
                    \parbox[t]{0.85\paperwidth}{%
                      \aptosDisplay\upshape\bfseries\fontsize{24pt}{28pt}\selectfont\color{CHAPBLUE}%
                      \raggedright
                      \@title\\[6pt]
                      \ifx\@subtitle\@empty\else\@subtitle\\[6pt]\fi
                      \ifx\@author\@empty\else\@author\fi
                    }%
                  }%
                }%
              }%
              \null\vfill
            \end{titlepage}%
            \global\CCcoverpagefalse
          }
          \makeatother

          % --------------------- BACK COVER PAGE (page after cover) ---------------------
          \usepackage{array}
          \usepackage{tabularx}
          
          \newcommand{\BackCoverTextBox}{%
            \fbox{%
              \begin{minipage}{0.86\textwidth}
                {\aptos\fontsize{10pt}{12pt}\selectfont
                \setlength{\tabcolsep}{8pt}%
                \renewcommand{\arraystretch}{1.15}%
                \begin{tabularx}{\linewidth}{>{\raggedright\arraybackslash}p{0.25\linewidth}|X}
                  \MakeUppercase{Copyright Notice\par and Disclaimer} &
                  © European Union, 2025\par\vspace{4pt}%
                  This document has been prepared for the European Commission by the Performance Review Board of the Single European Sky (PRB).\par\vspace{6pt}%
                  Reproduction is authorised provided the source is acknowledged. However, neither the European Commission, nor any person acting on its behalf, may be held responsible for the use which may be made of the information contained in this publication, or for any errors which may appear, despite careful preparation and checking.%
                  \\
                \end{tabularx}
                }%
              \end{minipage}%
            }%
          }
          
          % Wrap the existing \maketitle and append the back cover page
          \makeatletter
          \let\CC@orig@maketitle\maketitle
          \renewcommand{\maketitle}{%
            \CC@orig@maketitle
            \clearpage
            \thispagestyle{empty}%
            \setcounter{page}{0}% avoids cover footer (page=1) and footer logo (>1)
          
            % Back cover image (top centered, slightly below top edge)
            \AddToShipoutPictureFG*{%
              \AtPageUpperLeft{%
                \hspace*{0.5\paperwidth}%
                \raisebox{-1mm}{% increase (e.g. -6mm) to move down; decrease (e.g. -2mm) to move up
                  \makebox[0pt][c]{\includegraphics[width=2.8cm,height=0.17cm]{images/header_top.png}}%
                }%
              }%
            }%
          
            \null
            \vspace*{0.6\paperheight}%
            \begin{center}
              \BackCoverTextBox
            \end{center}
            \clearpage
          }
          \makeatother


          % --------------------- HEADER & FOOTER---------------------

          \usepackage{scrlayer-scrpage} % For customizing headers/footers
          \setlength{\headheight}{13mm} % increase if needed (e.g. 20mm)
          \setlength{\headsep}{8mm}     % distance from header to text body
          \setlength{\footskip}{1.3cm}
          \clearpairofpagestyles
    
          % Ensure the last page reference is available
          \usepackage{lastpage}
    
          % Add image in the center of the header
          \chead*{\raisebox{16mm}{\includegraphics[width=2.8cm,height=0.17cm]{images/header_top.png}}}
    
          % Move page numbering to the right-hand side of the header with new font style
          \ohead*{\makebox[0pt][r]{\raisebox{-10mm}{\textcolor{black}{\aptos\upshape\mdseries\fontsize{13pt}{15pt}\selectfont \thepage/\pageref*{LastPage}}}}}
          
          % logo image in footer
          \newcommand{\FooterLogo}{images/logo_footer.png}
          
          \AtBeginDocument{%
            \AddToShipoutPictureFG{%
              \ifnum\value{page}>1\relax
                \AtPageLowerLeft{%
                  \hspace*{\dimexpr\paperwidth-1.41cm-6mm\relax}%
                  \raisebox{5mm}{\includegraphics[width=1.41cm,height=1.05cm]{\FooterLogo}}%
                }%
              \fi
            }%
          }          
          % --------------------- BODY ---------------------
          \usepackage{array} % Add advanced table formatting
          % \newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}} % Left-aligned column without word breaking          
          
          \usepackage{float} % Allows [H] placement option

          \usepackage{textcomp}       % Additional text symbols
          \usepackage{amssymb}        % Enable ✓ and ✘ symbols
          \setmainfont{Cambria}        % Set Cambria as the main font  
          \newfontfamily{\symbolfont}{Segoe UI Symbol} % Set fallback for symbols
          \DeclareTextFontCommand{\textsymbol}{\symbolfont} % Define fallback symbol command          

          % Define commands for green ticks and red crosses
          \newcommand{\tick}{\textcolor{green}{\textsymbol{✓}}}
          \newcommand{\cross}{\textcolor{red}{\textsymbol{✘}}}          

          
          % Load titlesec package for section formatting
          % \usepackage{titlesec}
          \usepackage{needspace} % to avoid orphan titles
          

          % --------------------- CHAPTER STYLING ---------------------
          \RedeclareSectionCommand[
            beforeskip=0pt,
            afterskip=2pt
          ]{chapter}
          \setkomafont{chapter}{\aptos\bfseries\fontsize{16pt}{18pt}\selectfont\color{CHAPBLUE}\MakeUppercase}
          \renewcommand*\chapterpagestyle{plain} % optional; keep page style consistent
          % KOMA chapters already start new page in scrreprt/scrbook.
          
          % Section: Aptos, 14pt, spacing, color
          \RedeclareSectionCommand[
            beforeskip=4pt,
            afterskip=6pt
          ]{section}
          \setkomafont{section}{\aptos\mdseries\fontsize{14pt}{16pt}\selectfont\color{SECBLUE}}
          
          % Subsection: Aptos, 12pt, spacing, color
          \RedeclareSectionCommand[
            beforeskip=10pt,
            afterskip=6pt
          ]{subsection}
          \setkomafont{subsection}{\aptos\mdseries\fontsize{12pt}{14pt}\selectfont\color{SUBSECBLUE}}

          % --------------------- BIGGER TEXT COMMAND ---------------------
          \newcommand{\biggertext}[1]{{\bfseries\fontsize{13pt}{15pt}\selectfont #1}}
          
          \usepackage{makecell} % Enables multiline table headers
          
 
book:
  title: "Performance Review Body"
  subtitle: "Monitoring Report" 
  author: "{{< var doc.country >}} - {{< var doc.year_report >}}"
  chapters:
    - index.qmd


