```{r cap-level2-text}
# define ranges and import data
sheet <- country

## enroute 
range <- "J4:J6"
cap_er_1_1_r <- read_range(cap_file, sheet, range)  

range <- "A9:O13"
cap_er_1_2_r <- read_range(cap_file, sheet, range)  

range <- "A14:O18"
cap_er_1_3_r <- read_range(cap_file, sheet, range)  

range <- "A19:O23"
cap_er_1_4_r <- read_range(cap_file, sheet, range)  

range <- "A49:O53"
cap_er_1_6_r <- read_range(cap_file, sheet, range)  

# cap_er_1_5_r_acc <- ''
cap_er_1_5_r_txt <- ''
cap_er_1_5_r_obs <- ''
cap_er_1_5_r <- ''

for (i in 1:acc_no) {
  
  # range <- paste0("A", 24 + (i-1) * 4, ":D", 25 + (i-1) * 4)
  # cap_er_1_5_r_acc <- read_range(cap_file, sheet, range)  
  
  range <- paste0("K", 25 + (i-1) * 4, ":O", 27 + (i-1) * 4)
  cap_er_1_5_r_obs <- read_range(cap_file, sheet, range)  
  
  range <- paste0("A", 27 + (i-1) * 4, ":O", 28 + (i-1) * 4)
  cap_er_1_5_r_txt <- read_range(cap_file, sheet, range)  
  
  cap_er_1_5_r <- if_else(is.na(cap_er_1_5_r_txt[1,1]) == TRUE & is.na(cap_er_1_5_r_obs[1,1]) == TRUE, '', 
                          paste0(cap_er_1_5_r_txt[1,1], 
                                 if_else(is.na(cap_er_1_5_r_obs[1,1]) == TRUE, '', paste0('**Observations: **', cap_er_1_5_r_obs[1,1])),
                                 '\n')
                          )
  
}

range <- "A54:O58"
cap_er_1_7_r <- read_range(cap_file, sheet, range)  

## terminal
range <- "A3:U4"
cap_trm_1_1_r <- read_range(cap_trm_file, sheet, range) 

range <- "A5:U7"
cap_trm_1_2_r <- read_range(cap_trm_file, sheet, range) 
cap_trm_1_2 <- if_else(is.na(cap_trm_1_2_r[1,11]) == TRUE,
                        cap_trm_1_2_r[2,1], cap_trm_1_2_r[1,11])

range <- "A8:U10"
cap_trm_1_3_r <- read_range(cap_trm_file, sheet, range)  
cap_trm_1_3 <- paste0(if_else(is.na(cap_trm_1_3_r[1,10]) == TRUE, "", pull(cap_trm_1_3_r[1,10])), if_else(is.na(cap_trm_1_3_r[1,11]) == TRUE, "", pull(cap_trm_1_3_r[1,11])))

range <- "A11:U13"
cap_trm_1_4_r <- read_range(cap_trm_file, sheet, range) 
cap_trm_1_4 <- paste0(if_else(is.na(cap_trm_1_4_r[1,10]) == TRUE, "", pull(cap_trm_1_4_r[1,10])),
                      if_else(is.na(cap_trm_1_4_r[1,11]) == TRUE, "", pull(cap_trm_1_4_r[1,11])), 
                      if_else(is.na(cap_trm_1_4_r[2,1]) == TRUE, "", pull(cap_trm_1_4_r[2,1])))


range <- "A14:U15"
cap_trm_1_5_r <- read_range(cap_trm_file, sheet, range)  

range <- "A16:U17"
cap_trm_1_6_r <- read_range(cap_trm_file, sheet, range)  

range <- "A18:U19"
cap_trm_1_7_r <- read_range(cap_trm_file, sheet, range)  

```


[3 Capacity - {{< var doc.country >}}]{class="fakeh1"}

::: {#container-cap style="clear: both"}

## KPI – en route ATFM delay

<!-- empty line to ensure next heading leaves enough space -->
<div style="height: 1px"></div>

:::: {#chart-cap class="mychart"}
```{r chart-cap-er, options = (cztype=c("enroute"))}
#| file: R/chart_level1_cap.R
#| out.width: "100%"
```

<br>

```{r chart-cap-er-month, options = (cztype=c("enroute"))}
#| file: R/chart_level2_cap_month.R
#| out.width: "100%"
```
<br>

```{r chart-cap-delay-bin}
#| file: R/chart_level2_cap_delay_bin.R
#| out.width: "100%"
```

::::

:::: {#concl-cap}
```{r}
# cap_er_conc <- read_mytable("PRB_findings.xlsx", "ER_capacity", "Table_Findings_ER_capacity") %>% 
#   filter(Year_Report == params$year_report, State == params$country) %>% 
#   select(Conclusion) %>% toString() %>% paste0(., "@")
# 
# cap_er_conc1 <- cap_er_conc %>% str_replace_all(c('", ' = '\n\n', '\"' = '', '\n\n\n' = '\n\n')) %>% str_replace(fixed('c('), '') %>%  str_replace(fixed(')@'), '\n') 
```

**Summary of capacity performance**

`r cap_er_1_7_r[1,1]`

**NSA's assessment of capacity performance**

`r cap_er_1_2_r[1,1]`

**Monitoring process for capacity performance**

`r cap_er_1_3_r[1,1]`

**Capacity planning**

`r cap_er_1_4_r[1,1]`

**Application of Corrective Measures for Capacity (if applicable)**

`r cap_er_1_6_r[1,1]`

::::
:::

::: {#container-cap-atco style="clear: both"}

## ATCOs in OPS
<!-- empty line to ensure next heading leaves enough space -->
<div style="height: 1px"></div>

:::: {#chart-cap-atco class="mychart"}

```{r chart-cap-atco}
#| file: R/chart_level2_cap_atco.R
#| out.width: "100%"
```

<br>

```{r chart-cap-atco-acc}
#| file: R/chart_level2_cap_atco_acc.R
#| out.width: "100%"
```

::::

:::: {#concl-cap-atco}

`r cap_er_1_5_r`

::::
:::

::: {#container-cap-sector-opening style="clear: both"}

:::: {#chart-cap-sector-opening class="mychart"}

```{r chart-cap-sector-opening}
#| file: R/chart_level2_cap_sector_opening.R
#| out.width: "100%"
```

::::

:::: {#concl-cap-sector-opening}

::::
:::


`r if (params$no_tcz == 0) "::: {.content-hidden}"`

:::: {#container-cap style="clear: both"}

## KPI – terminal ATFM delay

<!-- empty line to ensure next heading leaves enough space -->
<div style="height: 1px"></div>

::::: {#chart-cap class="mychart"}

```{r chart-cap-trm, options = (cztype=c("terminal"))}
#| file: R/chart_level1_cap.R
#| out.width: "100%"
```

<br>

```{r chart-cap-trm-month, options = (cztype=c("terminal"))}
#| file: R/chart_level2_cap_month.R
#| out.width: "100%"
```
:::::

::::: {#concl-cap-trm}

`r cap_trm_1_1_r[1,1]`

`r cap_trm_1_2`

`r cap_trm_1_3`

:::::
::::

:::: {#container-cap-other style="clear: both"}

## Other indicators
<!-- empty line to ensure next heading leaves enough space -->
<!-- <div style="height: 1px"></div> -->

::::: {#chart-cap-all-causes-delay class="mychart"}

```{r chart-cap-all-causes-delay}
#| file: R/chart_level2_cap_all_causes_delay.R
#| out.width: "100%"
```


:::::

::::: {#concl-cap-cap-all-causes-delay}
**All causes pre departure delay**

`r cap_trm_1_6_r[1,1]`

:::::
::::

:::: {#container-cap-table-apt-pis style="clear: both"}

::::: {#concl-cap-apt-pis}

**ATFM slot adherence**

`r cap_trm_1_4`

**ATC pre-departure delay**

`r cap_trm_1_5_r[1,1]`

:::::

::::: {#table-cap-apt-pis}

```{r table-cap-apt-pis}
#| file: R/table_level2_cap_apt_pis.R
#| out.width: "100%"
```

<!-- ![](images/{{< var doc.year_report >}}/{{< var doc.country >}}/cap_trm_4.png) -->

:::::
::::

`r if (params$no_tcz == 0) ":::"`
